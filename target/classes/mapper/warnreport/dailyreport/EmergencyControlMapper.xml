<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="ths.project.warnreport.dailyreport.mapper.EmergencyControlMapper">
	<select id="selectAllBydata" resultType="ths.project.warnreport.dailyreport.entity.EmergencyControl">
		SELECT
			a.[ID],
			[TYPE_CODE],
			b.name TYPE_NAME,
			[DATA_TIME],
			[PEOPLE_NUMBER],
			[SITE_INSPECTION],
			[DEAL_ILLEGAL_CONSTRUCTION_SITE],
			[DEAL_ILLEGAL_CONSTRUCTION_SITE_VOCS],
			[DEAL_ILLEGAL_CONSTRUCTION_SITE_VOCS_AREA],
			[DEAL_ILLEGAL_CONSTRUCTION_SITE_EARTHWORK],
			[DEAL_ILLEGAL_CONSTRUCTION_SITE_EARTHWORK_AREA],
			[DEAL_ILLEGAL_CONSTRUCTION_NON_ROAD_MOBILE_MACHINERY],
			[DEAL_ILLEGAL_CONSTRUCTION_SITE_VOCS_TIMES],
			[INDUSTRIAL_INSPECTION],
			[INDUSTRIAL_ILLEGAL],
			[INSPECT_GARAGE],
			[ILLEGAL_SPRAYING_INSPECT_GARAGE],
			[INSPECT_CONCRETE_MIXING_STATION],
			[ILLEGAL_CONCRETE_MIXING_STATION],
			[INSPECT_ASPHALT_MIXING_STATION],
			[ILLEGAL_ASPHALT_MIXING_STATION],
			[DEAL_GAS_STATION],
			[ILLEGAL_GAS_STATION],
			[DEAL_OIL_DEPOT],
			[ILLEGAL_OIL_DEPOT],
			[DEAL_ILLEGAL_SLAG_TRUCK],
			[DEAL_ILLEGAL_CEMENT_TANKER],
			[DEAL_ILLEGAL_ASPHALT_TANKER],
			[BUS_FREQUENCY],
			[BUS_NUM],
			[SUBWAY_PASSENGER_VOLUME],
			[SUBWAY_RUNNING_TRAIN],
			[TOTAL_VEHICLE_FLOW],
			[BAN_OUTDOOR_BARBECUE_STALLS],
			[DEAL_WITH_OPEN_BURNING],
			[ILLEGAL_PRUNING_PESTICIDE_SPRAYING_OPERATIONS],
			[ROAD_WATERING_DUST_REMOVAL],
			[SUPPLEMENTARY_MATTERS],
			[CREATE_TIME]
		FROM
			DataCenter_V6.DAILY.T_BAS_SORT B
		LEFT JOIN
			(select * from DataCenter_V6.[DAILY].[T_BAS_EMERGENCY_CONTROL] where  DATA_TIME = CONVERT(DATETIME,CONVERT(VARCHAR(100),GETDATE()-2,23)+ ' 00:00:00' ,120)) A
		ON A.TYPE_NAME = B.NAME
		order by
			B.SORT
	</select>
	<select id="selectAllBydataMap" resultType="java.util.LinkedHashMap">
		SELECT
			b.name TYPE_NAME,
			[PEOPLE_NUMBER],
			[SITE_INSPECTION],
			[DEAL_ILLEGAL_CONSTRUCTION_SITE],
			[DEAL_ILLEGAL_CONSTRUCTION_SITE_VOCS],
			[DEAL_ILLEGAL_CONSTRUCTION_SITE_VOCS_AREA],
			[DEAL_ILLEGAL_CONSTRUCTION_SITE_EARTHWORK],
			[DEAL_ILLEGAL_CONSTRUCTION_SITE_EARTHWORK_AREA],
			[DEAL_ILLEGAL_CONSTRUCTION_NON_ROAD_MOBILE_MACHINERY],
			[DEAL_ILLEGAL_CONSTRUCTION_SITE_VOCS_TIMES],
			[INDUSTRIAL_INSPECTION],
			[INDUSTRIAL_ILLEGAL],
			[INSPECT_GARAGE],
			[ILLEGAL_SPRAYING_INSPECT_GARAGE],
			[INSPECT_CONCRETE_MIXING_STATION],
			[ILLEGAL_CONCRETE_MIXING_STATION],
			[INSPECT_ASPHALT_MIXING_STATION],
			[ILLEGAL_ASPHALT_MIXING_STATION],
			[DEAL_GAS_STATION],
			[ILLEGAL_GAS_STATION],
			[DEAL_OIL_DEPOT],
			[ILLEGAL_OIL_DEPOT],
			[DEAL_ILLEGAL_SLAG_TRUCK],
			[DEAL_ILLEGAL_CEMENT_TANKER],
			[DEAL_ILLEGAL_ASPHALT_TANKER],
			[BUS_FREQUENCY],
			[BUS_NUM],
			[SUBWAY_PASSENGER_VOLUME],
			[SUBWAY_RUNNING_TRAIN],
			[TOTAL_VEHICLE_FLOW],
			[BAN_OUTDOOR_BARBECUE_STALLS],
			[DEAL_WITH_OPEN_BURNING],
			[ILLEGAL_PRUNING_PESTICIDE_SPRAYING_OPERATIONS],
			[ROAD_WATERING_DUST_REMOVAL],
			[SUPPLEMENTARY_MATTERS]
		FROM
		DataCenter_V6.DAILY.T_BAS_SORT B
		LEFT JOIN
			(
			SELECT T1.* FROM DataCenter_V6.[DAILY].[T_BAS_EMERGENCY_CONTROL] T1 INNER JOIN (
				SELECT TYPE_NAME,MAX(CREATE_TIME) CREATE_TIME FROM DataCenter_V6.[DAILY].[T_BAS_EMERGENCY_CONTROL] WHERE
				<choose>
					<when test='endDateTime != null and endDateTime != ""'>
						DATA_TIME = CONVERT(DATETIME,#{endDateTime}+ ' 00:00:00' ,120)
					</when>
					<otherwise>
						DATA_TIME = CONVERT(DATETIME,CONVERT(VARCHAR(100),GETDATE(),23)+ ' 00:00:00' ,120)
					</otherwise>
				</choose>
				GROUP BY TYPE_NAME
			) T2 ON T1.CREATE_TIME = T2.CREATE_TIME AND T1.TYPE_NAME = T2.TYPE_NAME
		 ) A
		ON A.TYPE_NAME = B.NAME
		ORDER BY
			B.SORT
	</select>

</mapper>